<Lems>

    <!-- Include core NeuroML2 ComponentType definitions -->
    <Include file="Cells.xml"/>

    <!-- These may be moved to core NeuroML definition files -->
    
    <ComponentType name="vClampedCell" extends="baseCellMembPot" description="Still in development!!!"> 

        <Parameter name="delay" dimension="time"/>
        <Parameter name="duration" dimension="time"/>
        <Parameter name="baseVoltage" dimension="voltage"/>
        <Parameter name="targetVoltage" dimension="voltage"/>

        <Children name="populations" type="baseChannelPopulation"/>

        <Dynamics>

            <StateVariable name="v" exposure="v" dimension="voltage"/>

            <OnStart>
                <StateAssignment variable="v" value="baseVoltage"/>
            </OnStart>

            <OnCondition test="t .geq. delay .and. t .lt. duration+delay">
                <StateAssignment variable="v" value="targetVoltage"/>
            </OnCondition>

            <OnCondition test="t .gt. duration+delay">
                <StateAssignment variable="v" value="baseVoltage"/>
            </OnCondition>

        </Dynamics>

    </ComponentType>
    
    <ComponentType name="vClampedRampCell" extends="baseCellMembPot" description="Still in development!!!"> 

        <Parameter name="delay" dimension="time"/>
        <Parameter name="duration" dimension="time"/>
        <Parameter name="baseVoltage" dimension="voltage"/>
        <Parameter name="targetVoltage0" dimension="voltage"/>
        <Parameter name="targetVoltage1" dimension="voltage"/>

        <Children name="populations" type="baseChannelPopulation"/>

        <Dynamics>

            <StateVariable name="v" exposure="v" dimension="voltage"/>

            <OnStart>
                <StateAssignment variable="v" value="baseVoltage"/>
            </OnStart>

            <OnCondition test="t .geq. delay .and. t .lt. duration+delay">
                <StateAssignment variable="v" value="targetVoltage0 + (targetVoltage1-targetVoltage0)*(t-delay)/(duration)"/>
            </OnCondition>

            <OnCondition test="t .gt. duration+delay">
                <StateAssignment variable="v" value="baseVoltage"/>
            </OnCondition>

        </Dynamics>

    </ComponentType>
    


</Lems>
